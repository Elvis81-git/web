<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é»‘ç™½æ£‹ï¼š4x4 / 5x5</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f9f9f9;
      padding: 20px;
    }
    #board {
      display: grid;
      gap: 2px;
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: #4CAF50;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 30px;
      cursor: pointer;
      position: relative;
    }
    .black { color: black; }
    .white { color: white; }
    #status { font-size: 20px; margin: 10px; }
    #score { margin: 10px; }

    .hint::after {
      content: 'â€¢';
      position: absolute;
      font-size: 20px;
      color: yellow;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <h1>é»‘ç™½æ£‹ ğŸ¯</h1>

  <label for="size">æ£‹ç›¤å¤§å°ï¼š</label>
  <select id="size">
    <option value="4">4x4</option>
    <option value="5">5x5</option>
  </select>
  <button onclick="initGame()">é–‹å§‹éŠæˆ²</button>

  <div id="status">è«‹é¸æ“‡æ£‹ç›¤å¤§å°ä¸¦é–‹å§‹éŠæˆ²</div>
  <div id="score"></div>
  <div id="board"></div>

  <script>
    const boardDiv = document.getElementById("board");
    const statusDiv = document.getElementById("status");
    const scoreDiv = document.getElementById("score");
    let size = 4;
    let board = [];
    let currentPlayer = 'B';

    function initGame() {
      size = parseInt(document.getElementById("size").value);
      board = Array(size * size).fill(null);
      currentPlayer = 'B';

      // åˆå§‹åŒ–ä¸­å¿ƒå››æ ¼
      const mid = Math.floor(size / 2);
      board[mid * size + mid] = 'W';
      board[(mid - 1) * size + (mid - 1)] = 'W';
      board[mid * size + (mid - 1)] = 'B';
      board[(mid - 1) * size + mid] = 'B';

      render();
      statusDiv.textContent = "è¼ªåˆ°ï¼š\u26AB ç©å®¶ (é»‘)";
    }

    function render() {
      boardDiv.innerHTML = "";
      boardDiv.style.gridTemplateColumns = `repeat(${size}, 60px)`;

      board.forEach((cell, i) => {
        const div = document.createElement("div");
        div.className = "cell";

        if (!cell && canMove(i, currentPlayer)) {
          div.classList.add("hint");
        }

        const piece = cell === 'B' ? '<span class="black">\u26AB</span>' : (cell === 'W' ? '<span class="white">\u26AB</span>' : '');
        div.innerHTML = piece;
        div.onclick = () => handleClick(i);
        boardDiv.appendChild(div);
      });

      const score = {
        B: board.filter(c => c === 'B').length,
        W: board.filter(c => c === 'W').length
      };
      scoreDiv.textContent = `\u26AB é»‘: ${score.B}ã€€âšª ç™½: ${score.W}`;
    }

    function handleClick(index) {
      if (board[index] || !canMove(index, currentPlayer)) return;

      makeMove(index, currentPlayer);
      currentPlayer = currentPlayer === 'B' ? 'W' : 'B';

      if (!hasAnyMove(currentPlayer)) {
        currentPlayer = currentPlayer === 'B' ? 'W' : 'B';
        if (!hasAnyMove(currentPlayer)) {
          endGame();
          return;
        } else {
          alert("å°æ‰‹ç„¡æ³•è¡Œå‹•ï¼Œè¼ªå›ä½ ï¼");
        }
      }

      render();
      statusDiv.textContent = `è¼ªåˆ°ï¼š${currentPlayer === 'B' ? '\u26AB ç©å®¶ (é»‘)' : '\u26AA ç©å®¶ (ç™½)'}`;
    }

    function getFlips(index, player) {
      const directions = [-1, 1, -size, size, -size - 1, -size + 1, size - 1, size + 1];
      const flips = [];
      const opponent = player === 'B' ? 'W' : 'B';
      const row = Math.floor(index / size);
      const col = index % size;

      for (let dir of directions) {
        const temp = [];
        let i = index + dir;

        while (i >= 0 && i < size * size) {
          const r = Math.floor(i / size);
          const c = i % size;

          // é˜²æ­¢è¶Šç•Œç§»å‹•ï¼ˆå¦‚å¾ä¸€è¡Œè·³åˆ°ä¸‹ä¸€è¡Œï¼‰
          if (Math.abs(r - row) > Math.abs((i - index) / size) ||
              Math.abs(c - col) > Math.abs((i - index) % size)) break;

          if (board[i] === opponent) {
            temp.push(i);
          } else if (board[i] === player) {
            if (temp.length > 0) {
              flips.push(...temp);
            }
            break;
          } else {
            break;
          }
          i += dir;
        }
      }

      return flips;
    }

    function canMove(index, player) {
      return board[index] === null && getFlips(index, player).length > 0;
    }

    function hasAnyMove(player) {
      return board.some((_, i) => canMove(i, player));
    }

    function makeMove(index, player) {
      const flips = getFlips(index, player);
      flips.forEach(i => board[i] = player);
      board[index] = player;
    }

    function endGame() {
      const score = {
        B: board.filter(c => c === 'B').length,
        W: board.filter(c => c === 'W').length
      };

      if (score.B > score.W) {
        statusDiv.textContent = "ğŸ‰ é»‘æ–¹ç²å‹ï¼";
      } else if (score.W > score.B) {
        statusDiv.textContent = "ğŸ‰ ç™½æ–¹ç²å‹ï¼";
      } else {
        statusDiv.textContent = "ğŸ¤ å¹³æ‰‹ï¼";
      }
    }
  </script>
</body>
</html>
